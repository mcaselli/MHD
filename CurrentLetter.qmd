---
title: "Current Letter"
format: 
  html:
    embed-resources: true
---

```{r}
here::i_am("CurrentLetter.qmd")
library(here)
library(tidyverse)
library(ggrepel)
library(gghighlight)
library(ggpubr)
library(scales)
```


```{r, include=FALSE}
source(here("read_and_process_data.R"))
```


```{r}
n_municipalities <- length(levels(rev_inc$Municipality))
```

The state data on taxes and incomes covers `r n_municipalities` municipalities.

# Per Captia Income and Teacher Average Salary

Marblehead ranks
`r max(rev_inc$pci_rank) - mhd_percentiles$pci_rank + 1` 
in income per capita of the `r n_municipalities` municipalities in the state, higher than `r label_percent(accuracy=0.1)(mhd_percentiles$pci_percentile)` of them.


Less than `r label_percent(accuracy=1)(1-mhd_percentiles$pci_percentile)` 
of Massachusetts municipalities have per capita income higher than Marblehead, while a full 
`r label_percent(accuracy=1)(1-mhd_inc_sal_percentiles$salary_percentile)` 
of school districts in the state have a higher average teacher salary.


# Tax Receipts Per Capita

In terms of tax receipts per capita, Marblehead ranks
`r max(rev_inc$pc_receipts_rank) - mhd_percentiles$pc_receipts_rank + 1` 
of Massachusetts municipalities.

```{r}
mhd_pc_receipts <- rev_inc %>%
  filter(Municipality=="Marblehead") %>%
  pull(per_capita_receipts)

peer_median_pc_receipts <- rev_inc %>%
  filter(pci_peer) %>%
  summarize(median_pc_receipts = median(per_capita_receipts)) %>%
  pull(median_pc_receipts)
```

To provide further context, we looked at tax receipts among a peer group of 
municipalities with similar per capita income--the 5% of municipalities with per capita income directly above and below Marblehead's.

Marblehead's per capita tax receipts of  `r label_dollar()(mhd_pc_receipts)` is
`r label_percent()((peer_median_pc_receipts - mhd_pc_receipts)/peer_median_pc_receipts)` 
lower than the median of `r label_dollar()(peer_median_pc_receipts)` of its 
closest per capita income peers.


